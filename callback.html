<!--
  OIDC Debugger – Callback Page (Phase-1)
  Purpose: Display query and fragment parameters and decode id_token (unverified).
  Deploy: Serve as static file alongside index.html.
-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OIDC Debugger – Callback</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/app.css" />
  </head>
  <body>
    <main class="container">
      <header class="header">
        <h1>Local OIDC Debugger</h1>
        <p class="subtitle">Build auth requests, run flows, and inspect callbacks. Phase-1: no token exchange.</p>
        <a href="index.html" class="btn btn-secondary" style="margin-top: 1rem;">Back to Builder</a>
      </header>

      <div class="grid-3">
        <div class="card">
          <h2>Query params</h2>
          <pre id="query_json"></pre>
          <button id="copy_query" class="btn btn-secondary">Copy Query JSON</button>
        </div>
        <div class="card">
          <h2>Fragment params</h2>
          <pre id="fragment_json"></pre>
          <button id="copy_fragment" class="btn btn-secondary">Copy Fragment JSON</button>
        </div>
        <div class="card">
          <h2>Decoded ID Token (unverified)</h2>
          <pre id="idtoken_json"></pre>
          <button id="copy_idtoken" class="btn btn-secondary" disabled>Copy Decoded ID Token JSON</button>
        </div>
        <div class="card">
          <h2>Token Exchange (Phase-2)</h2>
          
          <div class="row">
            <div>
              <label for="tx_token_endpoint">Token endpoint <span class="muted">(required)</span></label>
              <input id="tx_token_endpoint" placeholder="https://issuer.example.com/oauth2/token" />
            </div>
            <div>
              <label for="tx_client_id">Client ID</label>
              <input id="tx_client_id" readonly />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="tx_redirect_uri">Redirect URI</label>
              <input id="tx_redirect_uri" readonly />
            </div>
            <div>
              <label for="tx_code">Authorization code</label>
              <input id="tx_code" readonly />
            </div>
          </div>

          <div>
            <label for="tx_code_verifier">Code verifier</label>
            <input id="tx_code_verifier" readonly />
          </div>

          <div>
            <label for="tx_result">Result</label>
            <pre id="tx_result"></pre>
            <button id="tx_exchange_btn" class="btn btn-primary">Exchange code</button>
          </div>
        </div>
        <div class="card">
          <h2>Tokens (raw)</h2>
          
          <div>
            <label for="tok_access">Access token</label>
            <textarea id="tok_access" class="tok-field" rows="3" readonly></textarea>
            <button id="copy_access_btn" class="btn btn-secondary" aria-label="Copy access token">Copy</button>
          </div>

          <div>
            <label for="tok_id">ID token</label>
            <textarea id="tok_id" class="tok-field" rows="3" readonly></textarea>
            <button id="copy_id_btn" class="btn btn-secondary" aria-label="Copy ID token">Copy</button>
          </div>

          <div>
            <label for="tok_refresh">Refresh token</label>
            <textarea id="tok_refresh" class="tok-field" rows="2" readonly></textarea>
            <button id="copy_refresh_btn" class="btn btn-secondary" aria-label="Copy refresh token">Copy</button>
          </div>

          <div class="row">
            <div>
              <label for="tok_type">Token type</label>
              <input id="tok_type" readonly />
            </div>
            <div>
              <label for="tok_expires_in">Expires in (seconds)</label>
              <input id="tok_expires_in" readonly />
            </div>
          </div>

          <div>
            <label for="tok_scope">Scope</label>
            <input id="tok_scope" readonly />
          </div>

          <p class="muted">Tokens shown here are returned by your IdP. Don't paste secrets into untrusted tools.</p>
        </div>
        <div class="card">
          <h2>JWT Decoders (decode-only)</h2>
          
          <p class="muted">Decoding only — signature NOT verified here. Use the Verification panel below to verify.</p>

          <div class="row">
            <div>
              <label>ID Token Header</label>
              <pre id="dec_id_header"></pre>
            </div>
            <div>
              <label>ID Token Payload</label>
              <pre id="dec_id_payload"></pre>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Access Token Header</label>
              <pre id="dec_access_header"></pre>
            </div>
            <div>
              <label>Access Token Payload</label>
              <pre id="dec_access_payload"></pre>
            </div>
          </div>

          <div class="actions">
            <button id="copy_dec_id_btn" class="btn btn-secondary">Copy ID Token (header+payload)</button>
            <button id="copy_dec_access_btn" class="btn btn-secondary">Copy Access Token (header+payload)</button>
          </div>
        </div>
      </div>
    </main>

    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
    <script src="assets/callback.js"></script>
  </body>
  </html>


